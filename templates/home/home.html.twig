{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
<main class="homepage">
    <!-- Carrousel Hero Section -->
        <div class="hero-carousel">
            <div class="carousel-container">
                <div class="carousel-slides">
                    <div class="carousel-slide active">
                        <img src="{{ asset('carousel1.jpg') }}" alt="Chat à poil long dans un cerisier en fleur">
                    </div>
                    <div class="carousel-slide">
                        <img src="{{ asset('carousel2.jpg') }}" alt="Bénévole de refuge entouré de chiens">
                    </div>
                    <div class="carousel-slide">
                        <img src="{{ asset('carousel3.jpg') }}" alt="Une femme et son chien assis de dos au coucher du soleil au bord d'une falaise.">
                    </div>
                    <div class="carousel-slide">
                        <img src="{{ asset('carousel4.jpg') }}" alt="Photo en noir et blanc d'un chien regardant un chat derrière des barreaux">
                    </div>
                    <div class="carousel-slide">
                        <img src="{{ asset('carousel5.jpg') }}" alt="Les mains d'un couple marié s'empilant avec une patte de chien au dessus de leurs mains">
                    </div>
                </div>
                
                <div class="carousel-content">
                    <h1>HOW I MET MY HUMAN</h1>
                    <h2>Chaque animal a son humain</h2>
                </div>
            </div>
        </div>

        <!-- Rectangle de recherche -->
        <div class="search-container">
            <div class="search-rectangle">
                <form method="GET" action="{{ path('animals') }}" class="search-form">
                    <div class="search-field">
                        <select name="species" id="type-select">
                            <option value="">Type</option>
                            {% for species in allSpecies %}
                                <option value="{{ species.id }}">{{ species.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="search-field">
                        <select name="sexe" id="sexe-select">
                            <option value="">Sexe</option>
                            <option value="male">Mâle</option>
                            <option value="femelle">Femelle</option>
                        </select>
                    </div>
                    <div class="search-field">
                        <select name="department" id="department-select">
                            <option value="">Département</option>
                            {% for department in allDepartments %}
                                <option value="{{ department.id }}">{{ department.code }} - {{ department.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="search-btn">
                        Votre compagnon idéal <i class="fa-solid fa-paw"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- Scroll indicator paw -->
        <div class="scroll-indicator">
            <i class="fas fa-paw"></i>
            <i class="fas fa-chevron-down scroll-chevron"></i>
        </div>

        <!-- Section des animaux les plus anciens -->
        <section class="oldest-animals-section">
            <div class="container">
                <div class="section-header">
                    <h3>Ils cherchent une famille</h3>
                    <p class="subtitle">Découvrez ces compagnons qui espèrent trouver leur nouveau foyer</p>
                </div>

                {% if oldest_animals is not empty %}
                    <div class="animals-carousel-container">
                        <button class="carousel-nav carousel-prev" aria-label="Animal précédent">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="animals-carousel">
                            {% for animal in oldest_animals %}
                                <div class="animal-card carousel-card" data-animal-id="{{ animal.id }}" data-index="{{ loop.index0 }}">
                                    <div class="card-image">
                                        {% if animal.imageName %}
                                            <img src="{{ asset('uploads/images/' ~ animal.imageName) }}" alt="{{ animal.name }}">
                                        {% else %}
                                            <div class="placeholder-image">
                                                {% if animal.species %}
                                                    {% if animal.species.name|lower == 'chien' %}
                                                        <i class="fas fa-dog"></i>
                                                    {% elseif animal.species.name|lower == 'chat' %}
                                                        <i class="fas fa-cat"></i>
                                                    {% elseif animal.species.name|lower == 'lapin' %}
                                                        <i class="fas fa-rabbit"></i>
                                                    {% elseif animal.species.name|lower == 'oiseau' %}
                                                        <i class="fas fa-dove"></i>
                                                    {% else %}
                                                        <i class="fas fa-paw"></i>
                                                    {% endif %}
                                                {% else %}
                                                    <i class="fas fa-paw"></i>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                        <div class="duration-badge">
                                            {% set daysSince = date().diff(animal.dateArrivee).days %}
                                            {% if daysSince < 30 %}
                                                {{ daysSince }} jour{{ daysSince > 1 ? 's' : '' }}
                                            {% elseif daysSince < 365 %}
                                                {{ (daysSince / 30.44)|round }} mois
                                            {% else %}
                                                {{ (daysSince / 365.25)|round(1) }} an{{ (daysSince / 365.25) > 1 ? 's' : '' }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="card-content">
                                        <div class="card-header">
                                            <div class="name-and-special-tags">
                                                <h3 class="animal-name">{{ animal.name }}</h3>
                                                {% if animal.tag is not empty %}
                                                    {% for tag in animal.tag %}
                                                        {% if tag.type|lower == 'sos' or 'education' in tag.type|lower or tag.type|lower == 'fad' %}
                                                            {% set tagClass = tag.type|lower|replace({' ': '-', '\'': '', 'é': 'e', 'è': 'e'}) %}
                                                            {% set tagDescription = tag.description ?: 'Description non disponible' %}
                                                            
                                                            <span class="tag-mini {{ tagClass }}" 
                                                                data-tooltip="{{ tagDescription }}" 
                                                                data-tag-name="{{ tag.type }}">
                                                                {% if 'education' in tag.type|lower %}
                                                                    <i class="fas fa-graduation-cap"></i>
                                                                {% elseif tag.type|lower == 'sos' %}
                                                                    SOS
                                                                {% elseif tag.type|lower == 'fad' %}
                                                                    FAD
                                                                {% endif %}
                                                            </span>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                            <div class="animal-badges">
                                                {% if animal.species %}
                                                    <span class="badge species-badge">{{ animal.species.name }}</span>
                                                {% endif %}
                                                <span class="badge age-badge">{{ animal.age }}</span>
                                                {% if animal.sexe == 'male' %}
                                                    <span class="badge gender-badge male">
                                                        <i class="fas fa-mars"></i> Mâle
                                                    </span>
                                                {% else %}
                                                    <span class="badge gender-badge female">
                                                        <i class="fas fa-venus"></i> Femelle
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="separator"></div>
                                        
                                        <div class="animal-description">
                                            <p class="description-text" data-full-text="{{ animal.description }}">
                                                {{ animal.description|length > 120 ? animal.description|slice(0, 120) ~ '...' : animal.description }}
                                            </p>
                                            {% if animal.description|length > 120 %}
                                                <button class="see-more-btn" data-animal-id="{{ animal.id }}">
                                                    Voir plus
                                                </button>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="card-actions">
                                            <button class="action-btn favorite-btn" data-animal-id="{{ animal.id }}" title="Ajouter aux favoris">
                                                <i class="far fa-heart"></i>
                                            </button>
                                            {% if animal.association and animal.association.contactEmail %}
                                                <button class="action-btn contact-btn" data-animal-id="{{ animal.id }}" title="Contacter l'association">
                                                    <i class="fas fa-envelope"></i>
                                                </button>
                                            {% else %}
                                                <button class="action-btn contact-btn disabled" disabled title="Aucun contact disponible">
                                                    <i class="fas fa-envelope"></i>
                                                </button>
                                            {% endif %}
                                            <button class="action-btn share-btn" data-animal-id="{{ animal.id }}" title="Partager">
                                                <i class="fas fa-share-alt"></i>
                                            </button>
                                            <a href="{{ path('animal_show', {'id': animal.id}) }}" class="action-btn view-btn" title="Voir la fiche complète">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </div>
                                        
                                        {% if animal.association %}
                                            <div class="association-info">
                                                <span class="association-name">{{ animal.association.name }}</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Indicateurs ronds -->
                        <div class="carousel-indicators">
                            {% for animal in oldest_animals %}
                                <button class="indicator-dot{{ loop.index0 == 0 ? ' active' : '' }}" 
                                        data-slide="{{ loop.index0 }}" 
                                        aria-label="Aller à l'animal {{ loop.index }}"></button>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="carousel-footer">
                        <a href="{{ path('animals') }}" class="btn-see-all">
                            Découvrir tous nos compagnons <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-paw"></i>
                        <p>Aucun animal disponible pour le moment.</p>
                    </div>
                {% endif %}
            </div>
        </section>

        <section class="info-section">
            <div class="info-container">
                <div class="photo-info">
                    <img src="{{asset ('info.jpg')}}" alt="Femme qui se promène avec son chien lors d'un coucher de soleil">
                </div>
                <div class="text-info">
                    <h4>Qui sommes-nous?</h4>
                    <p>Notre plateforme réunit un ensemble d'associations engagées dans la protection et le bien-être animal. Chaque structure partenaire œuvre quotidiennement pour recueillir, soigner et accompagner des animaux issus d'abandons, de maltraitances ou de situations d'urgence. Grâce à un réseau solide de bénévoles, de familles d'accueil et de professionnels, ces associations travaillent ensemble pour offrir à chaque animal à une seconde chance, dans un environnement adapté et sécurisé.</p>

                    <p>Nos partenaires couvrent un large territoire et disposent chacun de leurs propres spécialités : chiens, chats, équidés, nouveaux animaux de compagnie (NAC) ou encore structures polyvalentes capables d'accueillir plusieurs espèces. Cette diversité permet de répondre au mieux aux besoins spécifiques de chaque animal, avec un suivi attentif et un accompagnement personnalisé jusqu'à l'adoption.</p>
                    
                    <a href="{{ path('associations') }}" class="btn-associations">
                        <i class="fas fa-paw"></i>
                        Les associations
                    </a>
                </div>
            </div>
        </section>

        <!-- Section Statistiques -->
        <section class="stats-section">
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-paw"></i>
                    </div>
                    <div class="stat-content">
                        <p>{{ total_animals }} Animaux à adopter</p>
                        
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="stat-content">
                        <p>{{ total_associations }} Associations partenaires</p>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-content">
                        <p>100% Satisfaction</p>

                    </div>
                </div>
            </div>
        </section>

        <!-- Section Avis des Adoptants -->
        <section class="adopter-news-section">
            <h3>Ils ont trouvé leur humain</h3>

            {% if latest_news|length > 0 %}
                {# Premier carousel - défile vers la droite #}
                <div class="news-carousel news-carousel-right">
                    <div class="news-track">
                        {% for news in latest_news[:10] %}
                            <div class="news-card">
                                <div class="news-image">
                                    {% if news.imageName %}
                                        <img src="{{ vich_uploader_asset(news, 'imageFile') }}" alt="Photo partagée par {{ news.user.name }}">
                                    {% else %}
                                        <div class="news-image-placeholder">
                                            <i class="fas fa-paw"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="news-content">
                                    <p class="news-text">{{ news.content }}</p>
                                    <div class="news-meta">
                                        <span class="news-author"><i class="fas fa-user"></i> {{ news.user.name }}</span>
                                        <span class="news-date"><i class="fas fa-calendar"></i> {{ news.createdAt|date('d/m/Y') }}</span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        {# Duplicate for infinite scroll #}
                        {% for news in latest_news[:10] %}
                            <div class="news-card">
                                <div class="news-image">
                                    {% if news.imageName %}
                                        <img src="{{ vich_uploader_asset(news, 'imageFile') }}" alt="Photo partagée par {{ news.user.name }}">
                                    {% else %}
                                        <div class="news-image-placeholder">
                                            <i class="fas fa-paw"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="news-content">
                                    <p class="news-text">{{ news.content }}</p>
                                    <div class="news-meta">
                                        <span class="news-author"><i class="fas fa-user"></i> {{ news.user.name }}</span>
                                        <span class="news-date"><i class="fas fa-calendar"></i> {{ news.createdAt|date('d/m/Y') }}</span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                {# Deuxième carousel - défile vers la gauche #}
                <div class="news-carousel news-carousel-left">
                    <div class="news-track">
                        {% for news in latest_news[10:] %}
                            <div class="news-card">
                                <div class="news-image">
                                    {% if news.imageName %}
                                        <img src="{{ vich_uploader_asset(news, 'imageFile') }}" alt="Photo partagée par {{ news.user.name }}">
                                    {% else %}
                                        <div class="news-image-placeholder">
                                            <i class="fas fa-paw"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="news-content">
                                    <p class="news-text">{{ news.content }}</p>
                                    <div class="news-meta">
                                        <span class="news-author"><i class="fas fa-user"></i> {{ news.user.name }}</span>
                                        <span class="news-date"><i class="fas fa-calendar"></i> {{ news.createdAt|date('d/m/Y') }}</span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        {# Duplicate for infinite scroll #}
                        {% for news in latest_news[10:] %}
                            <div class="news-card">
                                <div class="news-image">
                                    {% if news.imageName %}
                                        <img src="{{ vich_uploader_asset(news, 'imageFile') }}" alt="Photo partagée par {{ news.user.name }}">
                                    {% else %}
                                        <div class="news-image-placeholder">
                                            <i class="fas fa-paw"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="news-content">
                                    <p class="news-text">{{ news.content }}</p>
                                    <div class="news-meta">
                                        <span class="news-author"><i class="fas fa-user"></i> {{ news.user.name }}</span>
                                        <span class="news-date"><i class="fas fa-calendar"></i> {{ news.createdAt|date('d/m/Y') }}</span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <p class="no-news">Aucune nouvelle pour le moment.</p>
            {% endif %}
        </section>

        <!-- Section Pourquoi adopter -->
        <section class="why-adopt-section">
            <div class="why-adopt-container">
                <div class="why-adopt-text">
                    <h4>Pourquoi adopter ?</h4>
                    <p>Adopter un animal, c'est offrir une seconde chance à un compagnon qui n'a souvent connu que l'incertitude. En choisissant l'adoption, vous contribuez à réduire la surpopulation dans les refuges et soutenez une démarche responsable et bienveillante. Chaque animal a son histoire, son caractère et son potentiel : en lui offrant un foyer, vous lui permettez de s'épanouir dans un environnement stable, tout en accueillant dans votre quotidien une présence fidèle et affectueuse. C'est un engagement précieux, fondé sur le respect, la patience et l'envie de construire une relation durable.</p>

                    <a href="{{ path('animals') }}" class="btn-adopt">
                        Je veux adopter
                        <i class="fas fa-paw"></i>
                    </a>
                </div>
                <div class="why-adopt-image">
                    <img src="{{ asset('man&dog.jpg') }}" alt="Homme et son chien marchant ensemble">
                </div>
            </div>
        </section>

        <!-- Section Associations Partenaires -->
        <section class="partners-section">
            <div class="partners-container">
                <h3>Nos Associations Partenaires</h3>

                {% if all_associations is not empty %}
                    <div class="partners-grid">
                        {% for association in all_associations %}
                            <a href="{{ path('associations_show', {'id': association.id}) }}" class="partner-card" title="{{ association.name }}">
                                {% if association.imageName %}
                                    <img src="{{ asset('uploads/images/' ~ association.imageName) }}" alt="Logo {{ association.name }}">
                                {% else %}
                                    <div class="partner-placeholder">
                                        <i class="fas fa-home"></i>
                                        <span>{{ association.name }}</span>
                                    </div>
                                {% endif %}
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="no-partners">Aucune association partenaire pour le moment.</p>
                {% endif %}
            </div>
        </section>

</main>
{% endblock %}
