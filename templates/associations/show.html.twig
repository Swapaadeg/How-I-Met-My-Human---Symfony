{% extends 'base.html.twig' %}

{% block title %}{{ association.name }} - Association{% endblock %}

{% block body %}
<div class="association-detail">
    <div class="container">
        <!-- En-tête de l'association -->
        <div class="header-card">
            <div class="content">
                <div>
                    <h1 class="title">{{ association.name }}</h1>
                    <p class="location">
                    <i class="fas fa-map-marker-alt"></i>
                    {{ association.codePostal }}
                    {% if association.department %}
                        - {{ association.department.name }}
                    {% endif %}
                </p>
                
                {% if association.contactEmail %}
                    <p class="email">
                        <i class="fas fa-envelope"></i>
                        <button class="contact-btn email-link" data-association-id="{{ association.id }}" type="button">
                            {{ association.contactEmail }}
                        </button>
                    </p>
                {% endif %}
                
                <div class="role-badge">
                    <i class="fas fa-user"></i> {{ user_role }}
                </div>
                
                {% if app.user %}
                    <div class="actions">
                        {% if pending_membership %}
                            <div class="pending-status-alert">
                                <i class="fas fa-hourglass-half"></i>
                                <span>Votre candidature est en cours d'acceptation par le gérant de l'association</span>
                            </div>
                        {% elseif can_join %}
                            <a href="{{ path('associations_join', {id: association.id}) }}" class="btn join">
                                <i class="fas fa-plus"></i> Rejoindre l'association
                            </a>
                        {% endif %}

                        {% if user_role != 'Visiteur' %}
                            <a href="{{ path('animals_add') }}" class="btn join">
                                <i class="fas fa-plus"></i> Ajouter un animal
                            </a>
                        {% endif %}

                        {% if can_manage %}
                            <a href="{{ path('associations_manage', {id: association.id}) }}" class="btn manage">
                                <i class="fas fa-cog"></i> Gérer les membres
                            </a>
                            <a href="{{ path('associations_edit', {id: association.id}) }}" class="btn edit">
                                <i class="fas fa-edit"></i> Modifier l'association
                            </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            {% if association.imageName %}
                <div>
                    <img src="{{ vich_uploader_asset(association, 'imageFile') }}" 
                         class="image" alt="{{ association.name }}">
                </div>
            {% endif %}
            </div>
        </div>

        <!-- Description -->
        <div class="description-card">
            <h5 class="card-title">À propos de l'association</h5>
            <p class="description">{{ association.description|nl2br }}</p>
        </div>

        <!-- Statistiques -->
        <div class="stats">
            <div class="stat-card">
                <h2 class="number primary">{{ association.animals|length }}</h2>
                <p class="label">Animaux à adopter</p>
            </div>
            <div class="stat-card">
                <h2 class="number success">{{ association.approvedMembers|length }}</h2>
                <p class="label">Membres actifs</p>
            </div>
        </div>

        <!-- Animaux de l'association -->
        {% if association.animals is not empty %}
            <div class="animals-card">
                <h5 class="card-title">Animaux à adopter</h5>
                <div class="animals-grid">
                    {% for animal in association.animals|slice(0, 6) %}
                        <a href="{{ path('animal_show', {'id': animal.id}) }}" class="animal-card">
                            {% if animal.imageName %}
                                <img src="{{ vich_uploader_asset(animal, 'imageFile') }}"
                                     class="image" alt="{{ animal.name }}">
                            {% endif %}
                            <div class="info">
                                <h6 class="name">{{ animal.name }}</h6>
                                <small class="species">{{ animal.species ? animal.species.name : 'Non spécifié' }}</small>
                            </div>
                        </a>
                    {% endfor %}
                </div>
                
                {% if association.animals|length > 6 %}
                    <div style="text-align: center; margin-top: 2rem;">
                        <a href="{{ path('animals') }}?association={{ association.id }}" class="view-all-btn">
                            Voir tous les animaux ({{ association.animals|length }})
                        </a>
                    </div>
                {% endif %}
            </div>
        {% else %}
            <div class="no-animals">
                <i class="fas fa-info-circle"></i>
                <p>Cette association n'a pas encore d'animaux à adopter.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}